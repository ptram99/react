{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\User\\\\~\\\\metaplex\\\\fair-launch\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\User\\\\~\\\\metaplex\\\\fair-launch\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\User\\\\~\\\\metaplex\\\\fair-launch\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{CircularProgress,Container,Link}from'@material-ui/core';import{useState}from'react';import{receiveRefund}from'./fair-launch';import MuiDialogContent from'@material-ui/core/DialogContent';import{LAMPORTS_PER_SOL}from'@solana/web3.js';import{toDate}from'./utils';import Countdown from'react-countdown';import Dialog from'@material-ui/core/Dialog';import{CTAButton}from'./MintButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var AntiRug=function AntiRug(_ref){var _toDate,_toDate2,_fairLaunch$ticket,_fairLaunch$ticket2,_fairLaunch$ticket3,_fairLaunch$ticket4,_fairLaunch$ticket4$d;var fairLaunch=_ref.fairLaunch,_ref$isMinting=_slicedToArray(_ref.isMinting,2),isMinting=_ref$isMinting[0],setIsMinting=_ref$isMinting[1],anchorWallet=_ref.anchorWallet,setAlertState=_ref.setAlertState;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),antiRugPolicyOpen=_useState2[0],setAnitRugPolicyOpen=_useState2[1];var onRugRefund=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(anchorWallet){_context.next=2;break;}return _context.abrupt(\"return\");case 2:console.log('refund');_context.prev=3;setIsMinting(true);_context.next=7;return receiveRefund(anchorWallet,fairLaunch);case 7:setIsMinting(false);setAlertState({open:true,message:'Congratulations! You have received a refund. This is an irreversible action.',severity:'success'});_context.next=16;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](3);console.log(_context.t0);setIsMinting(false);setAlertState({open:true,message:'Something went wrong.',severity:'error'});case 16:case\"end\":return _context.stop();}}},_callee,null,[[3,11]]);}));return function onRugRefund(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Container,{maxWidth:\"xs\",style:{position:'relative'},children:/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'row',justifyContent:'flex-end'},children:/*#__PURE__*/_jsx(Link,{component:\"button\",variant:\"body2\",color:\"textSecondary\",align:\"right\",onClick:function onClick(){setAnitRugPolicyOpen(true);},children:\"Anti-Rug Policy\"})})}),/*#__PURE__*/_jsx(Dialog,{open:antiRugPolicyOpen,onClose:function onClose(){setAnitRugPolicyOpen(false);},PaperProps:{style:{backgroundColor:'#222933',borderRadius:6}},children:/*#__PURE__*/_jsxs(MuiDialogContent,{style:{padding:24},children:[!fairLaunch.state.data.antiRugSetting&&/*#__PURE__*/_jsx(\"span\",{children:\"This Fair Launch has no anti-rug settings.\"}),fairLaunch.state.data.antiRugSetting&&fairLaunch.state.data.antiRugSetting.selfDestructDate&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Anti-Rug Policy\"}),/*#__PURE__*/_jsx(\"p\",{children:\"This raffle is governed by a smart contract to prevent the artist from running away with your money.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"How it works:\"}),\"This project will retain\",' ',fairLaunch.state.data.antiRugSetting.reserveBp/100,\"% (\\u25CE\",' ',fairLaunch.treasury*fairLaunch.state.data.antiRugSetting.reserveBp/(LAMPORTS_PER_SOL*10000),\") of the pledged amount in a locked state until all but\",' ',fairLaunch.state.data.antiRugSetting.tokenRequirement.toNumber(),' ',\"NFTs (out of up to\",' ',fairLaunch.state.data.numberOfTokens.toNumber(),\") have been minted.\",/*#__PURE__*/_jsxs(\"p\",{children:[\"If more than\",' ',fairLaunch.state.data.antiRugSetting.tokenRequirement.toNumber(),' ',\"NFTs remain as of\",' ',(_toDate=toDate(fairLaunch.state.data.antiRugSetting.selfDestructDate))===null||_toDate===void 0?void 0:_toDate.toLocaleDateString(),' ',\"at\",' ',(_toDate2=toDate(fairLaunch.state.data.antiRugSetting.selfDestructDate))===null||_toDate2===void 0?void 0:_toDate2.toLocaleTimeString(),\", you will have the option to get a refund of\",' ',fairLaunch.state.data.antiRugSetting.reserveBp/100,\"% of the cost of your token.\"]}),((_fairLaunch$ticket=fairLaunch.ticket)===null||_fairLaunch$ticket===void 0?void 0:_fairLaunch$ticket.data)&&!((_fairLaunch$ticket2=fairLaunch.ticket)!==null&&_fairLaunch$ticket2!==void 0&&_fairLaunch$ticket2.data.state.withdrawn)&&/*#__PURE__*/_jsx(CTAButton,{onClick:onRugRefund,variant:\"contained\",disabled:!!!fairLaunch.ticket.data||!fairLaunch.ticket.data.state.punched||Date.now()/1000<fairLaunch.state.data.antiRugSetting.selfDestructDate.toNumber(),children:isMinting?/*#__PURE__*/_jsx(CircularProgress,{}):Date.now()/1000<fairLaunch.state.data.antiRugSetting.selfDestructDate.toNumber()?/*#__PURE__*/_jsxs(\"span\",{children:[\"Refund in...\",/*#__PURE__*/_jsx(Countdown,{date:toDate(fairLaunch.state.data.antiRugSetting.selfDestructDate)})]}):'Refund'}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'-5px'},children:((_fairLaunch$ticket3=fairLaunch.ticket)===null||_fairLaunch$ticket3===void 0?void 0:_fairLaunch$ticket3.data)&&!((_fairLaunch$ticket4=fairLaunch.ticket)!==null&&_fairLaunch$ticket4!==void 0&&(_fairLaunch$ticket4$d=_fairLaunch$ticket4.data)!==null&&_fairLaunch$ticket4$d!==void 0&&_fairLaunch$ticket4$d.state.punched)&&/*#__PURE__*/_jsx(\"small\",{children:\"You currently have a ticket but it has not been punched yet, so cannot be refunded.\"})})]})]})})]});};","map":{"version":3,"sources":["C:/Users/User/~/metaplex/fair-launch/src/AntiRug.tsx"],"names":["CircularProgress","Container","Link","useState","receiveRefund","MuiDialogContent","LAMPORTS_PER_SOL","toDate","Countdown","Dialog","CTAButton","AntiRug","fairLaunch","isMinting","setIsMinting","anchorWallet","setAlertState","antiRugPolicyOpen","setAnitRugPolicyOpen","onRugRefund","console","log","open","message","severity","position","display","flexDirection","justifyContent","style","backgroundColor","borderRadius","padding","state","data","antiRugSetting","selfDestructDate","reserveBp","treasury","tokenRequirement","toNumber","numberOfTokens","toLocaleDateString","toLocaleTimeString","ticket","withdrawn","punched","Date","now","textAlign","marginTop"],"mappings":"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","sourcesContent":["import { CircularProgress, Container, Link } from '@material-ui/core';\r\nimport { useState } from 'react';\r\nimport { FairLaunchAccount, receiveRefund } from './fair-launch';\r\nimport MuiDialogContent from '@material-ui/core/DialogContent';\r\nimport { LAMPORTS_PER_SOL } from '@solana/web3.js';\r\nimport { toDate } from './utils';\r\nimport Countdown from 'react-countdown';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport { CTAButton } from './MintButton';\r\nimport { AlertState } from './utils';\r\n\r\nimport * as anchor from '@project-serum/anchor';\r\n\r\ntype AntiRugProps = {\r\n  fairLaunch: FairLaunchAccount;\r\n  isMinting: [boolean, (val: boolean) => void];\r\n  anchorWallet?: anchor.Wallet;\r\n  setAlertState: (val: AlertState) => void;\r\n};\r\nexport const AntiRug = ({\r\n  fairLaunch,\r\n  isMinting: [isMinting, setIsMinting],\r\n  anchorWallet,\r\n  setAlertState,\r\n}: AntiRugProps) => {\r\n  const [antiRugPolicyOpen, setAnitRugPolicyOpen] = useState(false);\r\n\r\n  const onRugRefund = async () => {\r\n    if (!anchorWallet) {\r\n      return;\r\n    }\r\n\r\n    console.log('refund');\r\n    try {\r\n      setIsMinting(true);\r\n      await receiveRefund(anchorWallet, fairLaunch);\r\n      setIsMinting(false);\r\n      setAlertState({\r\n        open: true,\r\n        message:\r\n          'Congratulations! You have received a refund. This is an irreversible action.',\r\n        severity: 'success',\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      setIsMinting(false);\r\n      setAlertState({\r\n        open: true,\r\n        message: 'Something went wrong.',\r\n        severity: 'error',\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Container maxWidth=\"xs\" style={{ position: 'relative' }}>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            flexDirection: 'row',\r\n            justifyContent: 'flex-end',\r\n          }}\r\n        >\r\n          <Link\r\n            component=\"button\"\r\n            variant=\"body2\"\r\n            color=\"textSecondary\"\r\n            align=\"right\"\r\n            onClick={() => {\r\n              setAnitRugPolicyOpen(true);\r\n            }}\r\n          >\r\n            Anti-Rug Policy\r\n          </Link>\r\n        </div>\r\n      </Container>\r\n      <Dialog\r\n        open={antiRugPolicyOpen}\r\n        onClose={() => {\r\n          setAnitRugPolicyOpen(false);\r\n        }}\r\n        PaperProps={{\r\n          style: { backgroundColor: '#222933', borderRadius: 6 },\r\n        }}\r\n      >\r\n        <MuiDialogContent style={{ padding: 24 }}>\r\n          {!fairLaunch.state.data.antiRugSetting && (\r\n            <span>This Fair Launch has no anti-rug settings.</span>\r\n          )}\r\n          {fairLaunch.state.data.antiRugSetting &&\r\n            fairLaunch.state.data.antiRugSetting.selfDestructDate && (\r\n              <div>\r\n                <h3>Anti-Rug Policy</h3>\r\n                <p>\r\n                  This raffle is governed by a smart contract to prevent the\r\n                  artist from running away with your money.\r\n                </p>\r\n                <p>How it works:</p>\r\n                This project will retain{' '}\r\n                {fairLaunch.state.data.antiRugSetting.reserveBp / 100}% (◎{' '}\r\n                {(fairLaunch.treasury *\r\n                  fairLaunch.state.data.antiRugSetting.reserveBp) /\r\n                  (LAMPORTS_PER_SOL * 10000)}\r\n                ) of the pledged amount in a locked state until all but{' '}\r\n                {fairLaunch.state.data.antiRugSetting.tokenRequirement.toNumber()}{' '}\r\n                NFTs (out of up to{' '}\r\n                {fairLaunch.state.data.numberOfTokens.toNumber()}) have been\r\n                minted.\r\n                <p>\r\n                  If more than{' '}\r\n                  {fairLaunch.state.data.antiRugSetting.tokenRequirement.toNumber()}{' '}\r\n                  NFTs remain as of{' '}\r\n                  {toDate(\r\n                    fairLaunch.state.data.antiRugSetting.selfDestructDate,\r\n                  )?.toLocaleDateString()}{' '}\r\n                  at{' '}\r\n                  {toDate(\r\n                    fairLaunch.state.data.antiRugSetting.selfDestructDate,\r\n                  )?.toLocaleTimeString()}\r\n                  , you will have the option to get a refund of{' '}\r\n                  {fairLaunch.state.data.antiRugSetting.reserveBp / 100}% of the\r\n                  cost of your token.\r\n                </p>\r\n                {fairLaunch.ticket?.data &&\r\n                  !fairLaunch.ticket?.data.state.withdrawn && (\r\n                    <CTAButton\r\n                      onClick={onRugRefund}\r\n                      variant=\"contained\"\r\n                      disabled={\r\n                        !!!fairLaunch.ticket.data ||\r\n                        !fairLaunch.ticket.data.state.punched ||\r\n                        Date.now() / 1000 <\r\n                          fairLaunch.state.data.antiRugSetting.selfDestructDate.toNumber()\r\n                      }\r\n                    >\r\n                      {isMinting ? (\r\n                        <CircularProgress />\r\n                      ) : Date.now() / 1000 <\r\n                        fairLaunch.state.data.antiRugSetting.selfDestructDate.toNumber() ? (\r\n                        <span>\r\n                          Refund in...\r\n                          <Countdown\r\n                            date={toDate(\r\n                              fairLaunch.state.data.antiRugSetting\r\n                                .selfDestructDate,\r\n                            )}\r\n                          />\r\n                        </span>\r\n                      ) : (\r\n                        'Refund'\r\n                      )}\r\n                      {}\r\n                    </CTAButton>\r\n                  )}\r\n                <div style={{ textAlign: 'center', marginTop: '-5px' }}>\r\n                  {fairLaunch.ticket?.data &&\r\n                    !fairLaunch.ticket?.data?.state.punched && (\r\n                      <small>\r\n                        You currently have a ticket but it has not been punched\r\n                        yet, so cannot be refunded.\r\n                      </small>\r\n                    )}\r\n                </div>\r\n              </div>\r\n            )}\r\n        </MuiDialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}